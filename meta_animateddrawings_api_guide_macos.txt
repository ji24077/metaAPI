Meta AnimatedDrawings API + TorchServe ì „ì²´ êµ¬í˜„ ê°€ì´ë“œ (ë§¥OS ì™„ì „íŒ)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ§© 0. ì „ì œ ì¡°ê±´ (ë§¥OS)

- ìš´ì˜ì²´ì œ: macOS (Intel/Apple Silicon ëª¨ë‘ ì§€ì›)
- Python: 3.10.x (3.12 ë“± ìµœì‹ ì€ í˜¸í™˜ ë¶ˆê°€)
- Conda ë˜ëŠ” venv ê¸°ë°˜ ê°€ìƒí™˜ê²½ ê¶Œì¥
- Homebrew ì„¤ì¹˜ í•„ìš” (íŒ¨í‚¤ì§€ ê´€ë¦¬ìš©)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“ 1. ê°œë°œ í™˜ê²½ ì„¤ì • (ë§¥OS)

1.1. Homebrew ì„¤ì¹˜ (ì—†ëŠ” ê²½ìš°):
  /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

1.2. ê°€ìƒí™˜ê²½ ìƒì„± (conda ì˜ˆì‹œ):
  conda create -n metaapi python=3.10
  conda activate metaapi

1.3. í•„ìˆ˜ íŒ¨í‚¤ì§€ ì„¤ì¹˜:
  pip install torchserve torch-model-archiver torch torchvision torch-model-archiver

1.4. ì¶”ê°€ ì˜ì¡´ì„±:
  pip install matplotlib opencv-python numpy==1.24.4 openmim

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“¦ 2. mmcv-full ì„¤ì¹˜ (ë§¥OS í•¸ë“¤ëŸ¬ ì˜ì¡´ì„± í•´ê²°)

- ê¸°ì¡´ mmcv ê´€ë ¨ ì œê±°:
  pip uninstall mmcv-lite mmcv-full mmcv -y

- openmim ì„¤ì¹˜:
  pip install -U openmim

- ë§¥OS CPU í™˜ê²½ ê¸°ì¤€:
  mim install "mmcv-full<2.0.0"

- (Apple Silicon M1/M2 ìµœì í™”):
  pip install torch torchvision --index-url https://download.pytorch.org/whl/cpu

- ì„¤ì¹˜ í™•ì¸:
  python - <<EOF
import mmcv; print(mmcv.__version__)
import mmcv.ops, mmcv._ext
print("âœ… mmcv-full OK")
EOF

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âš™ï¸ 3. TorchServe ì„¤ì¹˜ ë° ëª¨ë¸ ë“±ë¡ (ë§¥OS)

3.1. Java JDK ì„¤ì¹˜ (TorchServe ìš”êµ¬):
  brew install openjdk@17
  echo 'export PATH="/opt/homebrew/opt/openjdk@17/bin:$PATH"' >> ~/.zshrc
  source ~/.zshrc

3.2. ëª¨ë¸ ì¤€ë¹„:
  mkdir model-store
  wget https://github.com/facebookresearch/AnimatedDrawings/releases/download/v0.0.1/drawn_humanoid_detector.mar -P model-store/
  wget https://github.com/facebookresearch/AnimatedDrawings/releases/download/v0.0.1/drawn_humanoid_pose_estimator.mar -P model-store/

3.3. config.properties ì˜ˆì‹œ (ë§¥OS ìµœì í™”):
  inference_address=http://0.0.0.0:8080
  management_address=http://0.0.0.0:8081
  model_store=model-store
  load_models=all
  default_workers_per_model=1
  vmargs=-XX:+UseContainerSupport -XX:MaxRAMPercentage=50.0 -Xms512m -Xmx2g

3.4. TorchServe ì‹¤í–‰:
  torchserve --start \
    --model-store model-store \
    --models all \
    --ts-config config.properties \
    --foreground

3.5. ì •ìƒ ìƒíƒœ í™•ì¸:
  curl http://localhost:8080/ping        # {"status":"Healthy"}
  curl http://localhost:8080/models      # ëª¨ë¸ ë¡œë”© ì •ë³´

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ” 4. AnimatedDrawings ì„¤ì¹˜ ë° ì‚¬ìš© (ë§¥OS)

4.1. GitHub ì†ŒìŠ¤ í´ë¡  + ì„¤ì¹˜:
  git clone https://github.com/facebookresearch/AnimatedDrawings.git
  cd AnimatedDrawings
  pip install -e .

4.2. ì¶”ê°€ ì˜ì¡´ì„± (ë§¥OS ìµœì í™”):
  pip install opencv-python matplotlib numpy==1.24.4

4.3. ê°„ë‹¨ ì‹¤í–‰ í…ŒìŠ¤íŠ¸:
  python image_to_animation.py \
    drawings/garlic.png garlic_out

4.4. Python API ì˜ˆì‹œ:
  from animated_drawings import render
  render.start('examples/config/mvc/export_mp4_example.yaml')

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ› ï¸ 5. Flask ì—°ë™ ì˜ˆì‹œ (ë§¥OS)

- POST /upload:
    1. ì—…ë¡œë“œ ì´ë¯¸ì§€ ì €ì¥
    2. subprocess.run(['python', 'image_to_animation.py', input.png, output_dir])
    3. ê²°ê³¼ video.gif ë˜ëŠ” mp4 ì „ì†¡

- GET /result/<file> â†’ íŒŒì¼ ë¦¬í„´/ì¡°íšŒ

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ¨ 6. Web í”„ë¡ íŠ¸ ì—°ë™ ì˜ˆì‹œ

- ì‚¬ìš©ì ì—…ë¡œë“œ ë²„íŠ¼: PNG/JPG ì´ë¯¸ì§€ drag & drop
- ê²°ê³¼ ì˜ìƒ ì¬ìƒ ì˜ì—­: <video src="output/video.mp4" controls>
- ì—…ë¡œë“œ í›„ ìë™ ì¬ìƒ ê¸°ëŠ¥ ì¶”ê°€
- fetch('/upload', { method: 'POST', body: formData })

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ› 7. ë””ë²„ê¹… & ë¬¸ì œ í•´ê²° (ë§¥OS íŠ¹í™”)

7.1. mmcv í•¸ë“¤ëŸ¬ ì—ëŸ¬:
  ModuleNotFoundError: mmcv.ops / mmcv._ext â†’ mmcv-full ë¯¸ì„¤ì¹˜

7.2. TorchServe ëª¨ë¸ ë¡œë”© ì‹¤íŒ¨:
  curl /models ì¶œë ¥ ì—†ìŒ / logs: Worker died í™•ì¸

7.3. ë©”ëª¨ë¦¬ ë¶€ì¡± (ë§¥OS):
  Activity Monitorì—ì„œ Java í”„ë¡œì„¸ìŠ¤ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ í™•ì¸
  config.propertiesì˜ vmargs ì¡°ì •

7.4. config ê²½ë¡œ ì˜¤ë¥˜:
  render.start() í˜¸ì¶œ ì‹œ ì‹¤ì œ YAML ê²½ë¡œ í™•ì¸

7.5. pose ì¸ì‹ ì´ìƒ:
  fix_annotations.py ì‹¤í–‰í•˜ì—¬ annotations ë³´ì •

7.6. ë§¥OS íŠ¹í™” ë¬¸ì œ:
  - ê¶Œí•œ ë¬¸ì œ: sudo ê¶Œí•œ í•„ìš” ì‹œ í™•ì¸
  - í¬íŠ¸ ì¶©ëŒ: lsof -i :8080 ìœ¼ë¡œ í¬íŠ¸ ì‚¬ìš© í™•ì¸
  - Homebrew ê²½ë¡œ: echo $PATH í™•ì¸

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“Œ 8. ê¶Œì¥ íŒ¨í‚¤ì§€ ë²„ì „ ìš”ì•½ (ë§¥OS)

- Python: 3.10.x
- torch: 2.0.x (CPU) - Apple Silicon ìµœì í™”
- torchserve: 0.11.0 ~ 0.12.0
- mmcv-full: 1.7.x (<2.0.0)
- numpy: 1.24.4
- opencv-python: ìµœì‹  ì•ˆì • ë²„ì „
- matplotlib, torchvision: ìµœì‹  í˜¸í™˜ ë²„ì „
- Java: OpenJDK 17 (Homebrew)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ 9. ë§¥OS íŠ¹í™” íŒ

9.1. Apple Silicon (M1/M2) ìµœì í™”:
  - Rosetta 2 í•„ìš” ì‹œ: softwareupdate --install-rosetta
  - ARM64 ë„¤ì´í‹°ë¸Œ ë¹Œë“œ ê¶Œì¥

9.2. ì„±ëŠ¥ ìµœì í™”:
  - Activity Monitorë¡œ CPU/ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§
  - í„°ë¯¸ë„ì—ì„œ htop ì„¤ì¹˜: brew install htop

9.3. ê°œë°œ í™˜ê²½:
  - VS Code ë˜ëŠ” PyCharm ì‚¬ìš© ê¶Œì¥
  - iTerm2 ì„¤ì¹˜: brew install iterm2

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… ì´ ë¬¸ì„œ í•˜ë‚˜ë¡œ ë§¥OS í™˜ê²½ì—ì„œ í”„ë¡œì íŠ¸ ì „ì²´ êµ¬ì„±ë¶€í„° ë¹Œë“œ, ì‹¤í–‰, ë””ë²„ê¹…, ì—°ë™ê¹Œì§€ **ëª¨ë“  ë‹¨ê³„ë¥¼ ì™„ì „í•˜ê²Œ ì»¤ë²„**í•©ë‹ˆë‹¤. 